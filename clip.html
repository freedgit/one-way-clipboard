<meta charset="UTF-8">
    <html>
    <head>
       <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
    <textarea id="textarea" name="textarea"></textarea>
    <button onclick="copy_to_clipboard()">Copy to Local Clipboard</button>

    <form method="POST" action="/form/" id="submit_form" name="submit_form">
    <textarea id="pastearea" name="pastearea"></textarea>
    <button onclick="copy_to_remote_clipboard()">Copy to Remote Clipboard</button>
    </form>
    <p id="demo" />
    <script>

var counterino = 0;

function reqListener () {
    var jsonString = this.responseText;
    var obj = jQuery.parseJSON(jsonString);
    
    console.log(obj);
    
    if (obj.type == "url") {
        window.open(obj.content, '_blank');
    } else if (obj.type == "content") {
        document.getElementById("textarea").innerHTML = obj.content;
        localStorage.setItem("clipboard", obj.content);
    }
    
    console.log(obj.type);
    console.log(obj.content);
}

function copy_to_clipboard() {
    var content = document.getElementById("textarea").innerHTML;
    navigator.clipboard.writeText(content);
}

function copy_to_remote_clipboard() {
    var form = document.getElementById("submit_form");
    form.submit();
}


function load_defaults() {
    content = localStorage.getItem("clipboard");
    document.getElementById("textarea").innerHTML = content;
}

function load_request() {
    var loop = 1;

    MAX_STUFF = 7;
    WAITING_FOR = 5 * 1000;

    while (true) {
        if (loop > MAX_STUFF) {
            break;
        }

        loop++;
        
        setTimeout(function() {
            var xr = new XMLHttpRequest();
            xr.addEventListener("load", reqListener)
            xr.open("GET", "http://localhost:9999");
            xr.send();

            counterino++;
            
            console.log(xr);
            console.log(counterino);

            if (counterino == MAX_STUFF) {
                console.log("I was supposed to reload");
                window.location = window.location;
                // window.location.reload();
            }
        }, WAITING_FOR * loop);
    }

    console.log("getting out of the loop");
}

load_defaults();

load_request();

</script>
</body>
</html>
